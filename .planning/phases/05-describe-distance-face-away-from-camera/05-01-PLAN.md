---
phase: 05-describe-distance-face-away-from-camera
plan: 01
type: execute
---

<objective>
Calculate and display relative face distance from camera using facial landmark measurements to provide calibration feedback and help users understand how camera distance affects mouth detection accuracy.

Purpose: Enable users to position themselves at optimal distance for reliable mouth state detection and provide debugging information for threshold tuning.
Output: Real-time face distance metric displayed on video feed with visual distance indicator.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mouth-detection-logic/03-01-SUMMARY.md
@main.py

**Tech stack available:** opencv-python, mediapipe (v0.10.31 with FaceLandmarker API), numpy

**Established patterns:**
- MediaPipe Face Landmarker with video mode processing
- Normalized to pixel coordinate conversion
- Text overlays using cv2.putText at consistent positions
- Color-coded visual feedback (green=normal, red=alert)
- Constants at top of file for tunable parameters

**Constraining decisions:**
- Phase 3: Use absolute pixel distance for measurements, display metrics in top-left area
- Phase 3: Color-coding convention: green=normal/closed, red=open/alert

**Current state:**
Mouth detection working with distance calculation between landmarks 13 and 14, threshold-based state detection, and color-coded visual feedback. Ready to add face distance metric for calibration.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Calculate face width metric from landmarks</name>
  <files>main.py</files>
  <action>Add face width calculation using MediaPipe Face Mesh landmarks. Use landmarks 234 (left face boundary) and 454 (right face boundary) which represent the widest points of the face. After converting face_landmarks to pixel coordinates, calculate the Euclidean distance between these two landmarks as face_width_px. This metric inversely correlates with distance from camera - larger face_width_px means closer to camera, smaller means farther away. Do NOT use normalized coordinates for this measurement - convert to pixels first for consistency with mouth distance calculation. Calculate face_width_px in the same section where mouth distance is calculated (after pixel coordinate conversion). Store in variable for display in next task.</action>
  <verify>Run script, move face closer/farther from camera - face_width_px value should increase when moving closer, decrease when moving farther</verify>
  <done>Face width calculation works, value changes appropriately with camera distance, calculation follows established pixel-based measurement pattern</done>
</task>

<task type="auto">
  <name>Task 2: Display face distance metric with visual indicator</name>
  <files>main.py</files>
  <action>Display face width metric below state text at coordinates (10, 90) using cv2.putText(). Format as "Face Width: XXX px" rounded to 0 decimal places. Use white text color (255, 255, 255) for consistency with distance display, font FONT_HERSHEY_SIMPLEX, scale 0.7, thickness 2. Below this, add a simple distance indicator at (10, 120): "Distance: [CLOSE | OK | FAR]" determined by face_width_px thresholds - CLOSE if face_width_px > 250, OK if 150-250, FAR if < 150. Color-code the indicator text: red (0, 0, 255) for CLOSE/FAR (suboptimal), green (0, 255, 0) for OK (optimal range). These thresholds are estimates for typical webcam setup and provide qualitative feedback. Do NOT add background boxes or complex graphics - keep display minimal and clean following established pattern.</action>
  <verify>Run script - face width displays below state, distance indicator shows CLOSE/OK/FAR and changes color appropriately as face moves, text remains readable and aligned</verify>
  <done>Face width metric visible, distance indicator updates in real-time, color coding works (green=OK, red=CLOSE/FAR), display clean and minimal, provides useful calibration feedback</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Script runs without errors
- [ ] Face width calculation accurate and updates in real-time
- [ ] Face width value increases when moving closer, decreases when moving farther
- [ ] Distance indicator (CLOSE/OK/FAR) transitions smoothly
- [ ] Color coding provides clear visual feedback (green=optimal, red=suboptimal)
- [ ] All existing functionality (mouth detection, state display) still works
- [ ] Display remains clean and readable with new metrics
- [ ] 'q' key still quits application
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Face width metric calculated and displayed
- Distance indicator provides qualitative feedback (CLOSE/OK/FAR)
- Color-coded visual feedback helps users position optimally
- Existing mouth detection functionality preserved
- Real-time performance maintained
- Ready for Phase 4 (Raspberry Pi optimization) with enhanced debugging info
</success_criteria>

<output>
After completion, create `.planning/phases/05-describe-distance-face-away-from-camera/05-01-SUMMARY.md`:

# Phase 5 Plan 1: Face Distance Metric Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `main.py` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 5 complete. Face distance metric provides calibration feedback for optimal mouth detection. Ready for Phase 4 (Raspberry Pi Optimization) with enhanced debugging capabilities.
</output>
